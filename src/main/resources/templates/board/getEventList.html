<!DOCTYPE html>
<html lang="ko"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
	<th:block layout:fragment="css">
		<link rel="stylesheet" th:href="@{/css/board/boardList.css}"/>
	</th:block>
	<th:block layout:fragment="script">
		<script th:inline="javascript">
			$(function() {
				$(".pagination_button a").on("click", function(e) {
					e.preventDefault();
					$.ajax({
						url: '/board/event/4',
						type: 'post',
						data: {	page: $(e.target).attr("data-page-num")},
						success: function(obj) {
							console.log(obj);
							
							let htmlStr = "";
							
							for(let i=0; i<obj.pageItems.content.length; i++) {
								htmlStr += `
									<tr>
										<td class="list-title">
											<a href="/board/updateBoardCnt/${obj.pageItems.content[i].boardNo}">
											${obj.pageItems.content[i].boardTitle}
											</a>
										</td>			
										<td class="list-date">${obj.pageItems.content[i].boardRegdate == null ? '' : obj.pageItems.content[i].boardRegdate.substring(0, 10)}</td>
									</tr>
								`;
							}
							$("#list-table").children(":first").children().not(":first").remove();
							$("#list-table").children(":first").append(htmlStr);
						},
						error: function(e) {
							console.log(e);
							console.log($(e.target).attr("data-page-num"));
						}
					})
					/*.done(function(result) {
						$("#list-table").replaceWith(result);
					});*/
				});
			});
		</script>
	</th:block>
</head>
<body>
<div layout:fragment="content" style="height: 80%;">
	<div id="container">
	  <div id="high-nav">
	    <button id="event-button">
	      이벤트
	    </button>
	  </div>
	  <div id="high-container">
	    <div id="mid-container">
	      <table id="list-table">
	        <tr>
	          <th width="80%" id="th-title">제목</th>
	          <th width="20%" id="th-date">작성일</th>
	        </tr>
	        <tr th:each="event: ${getBoardList}">
	          <td class="list-title">
	          	<a th:text="${event.boardTitle}"
				   th:href="@{/board/updateBoardCnt/{boardNo} (boardNo=${event.boardNo})}">
				</a>
	          </td>
	          <td class="list-date" th:text="${event.boardRegdate eq null ? '' : #strings.substring(event.boardRegdate, 0, 10)}"></td>
	        </tr>
	      </table>
	      <br/>
		  <div style="text-align:center;">
			<ul class="pagination" style="display: flex; justify-content: center;" 
				th:if="${getBoardList.totalElements > 0}"
				th:with="pageNumber = ${getBoardList.pageable.pageNumber},
									pageSize = ${getBoardList.pageable.pageSize},
									totalPages = ${getBoardList.totalPages},
									startPage =${T(java.lang.Math).floor(pageNumber / pageSize) * pageSize + 1},
									tempEndPage = ${startPage + pageSize -1}, 
									endPage = ${tempEndPage > totalPages ? totalPages : tempEndPage}">
					<li class="pagination_button" th:if="${pageNumber > 0}">
						<a th:data-page-num="${pageNumber - 1}"><</a>
					</li>
					<li class="pagination_button" th:each="page : ${#numbers.sequence(startPage, endPage)}">
						<a th:data-page-num="${page - 1}" th:text="${page}"></a>
					</li>
					<li class="pagination_button" th:if="${pageNumber < totalPages - 1}">
						<a th:data-page-num="${pageNumber + 1}">></a>
					</li>
				</ul>
			</div>
	    </div>
	  </div>
	</div>
</div>
</body>
</html>